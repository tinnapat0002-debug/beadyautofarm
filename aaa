--========================================================
--              FLUENT UI AUTO FARM SYSTEM               
--========================================================

local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Window = Fluent:CreateWindow({
    Title = "Smart Auto Farm System",
    SubTitle = "Grape & Fishing Farm",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Main = Window:AddTab({ Title = "üè† Main", Icon = "home" }),
    Info = Window:AddTab({ Title = "‚ÑπÔ∏è Info", Icon = "info" })
}

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

-- Global Variables
local AutoFarmEnabled = _G.CONFIG.AutoFarmOnStart

local isFishing = false
local isSelling = false
local isTeleporting = false
local isBuyingBait = false
local isFarming = false
local isProcessing = false
local isBuyingFood = false
local currentActivity = "grape" -- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å "grape"
local shouldStopGrapeFarm = false

local GRAPE_FARM_POSITION = Vector3.new(5334, 477, 2737)
local PLAYER_DETECTION_RANGE = 500

--========================================================
--                  HELPER FUNCTIONS                     
--========================================================

local function createFishingPlatform()
    pcall(function()
        local oldPart = workspace:FindFirstChild("FishingPlatform")
        if oldPart then
            oldPart:Destroy()
        end
        
        local part = Instance.new("Part")
        part.Name = "FishingPlatform"
        part.CFrame = CFrame.new(-671, 20, -2950)
        part.Anchored = true
        part.Size = Vector3.new(10, 2, 10)
        part.Transparency = 0.5
        part.CanCollide = true
        part.Parent = workspace
        
        print("‚úÖ Created fishing platform")
    end)
end

local function checkNearbyPlayers()
    local nearbyPlayers = {}
    
    pcall(function()
        local myChar = player.Character
        if not myChar then return end
        
        local myHrp = myChar:FindFirstChild("HumanoidRootPart")
        if not myHrp then return end
        
        for _, otherPlayer in ipairs(Players:GetPlayers()) do
            if otherPlayer ~= player then
                local otherChar = otherPlayer.Character
                if otherChar then
                    local otherHrp = otherChar:FindFirstChild("HumanoidRootPart")
                    if otherHrp then
                        local distance = (myHrp.Position - otherHrp.Position).Magnitude
                        if distance <= PLAYER_DETECTION_RANGE then
                            table.insert(nearbyPlayers, {
                                player = otherPlayer,
                                distance = distance
                            })
                        end
                    end
                end
            end
        end
    end)
    
    return nearbyPlayers
end

--========================================================
--                  FISHING FUNCTIONS                     
--========================================================

local function toggleFishingRod()
    pcall(function()
        local args = {"FishingRod", "", ""}
        game.Lighting:WaitForChild("Sky"):WaitForChild("Optimized"):FireServer(unpack(args))
    end)
end

local function getCurrentWeight()
    local success, weightText = pcall(function()
        return player.PlayerGui["Inventory1.5"].Frame.Main.Frame.Frame.TextLabel.Text
    end)
    
    if success and weightText then
        local currentWeight = tonumber(string.match(weightText, "([%d%.]+)/"))
        return currentWeight, weightText
    end
    
    return nil, nil
end

local function getBaitAmount()
    local amount = 0
    pcall(function()
        local baitItem = player.PlayerGui["Inventory1.5"].Frame.Main.ScrollingFrame.Scrolling:FindFirstChild("Bait")
        if baitItem then
            amount = tonumber(baitItem:GetAttribute("value")) or 0
        end
    end)
    return amount
end

local function getFishAmount(fishName)
    local amount = 0
    pcall(function()
        local fishItem = player.PlayerGui["Inventory1.5"].Frame.Main.ScrollingFrame.Scrolling:FindFirstChild(fishName)
        if fishItem then
            amount = tonumber(fishItem:GetAttribute("value")) or 0
        end
    end)
    return amount
end

local function buyBait()
    isBuyingBait = true
    
    local SHOP_POSITION = Vector3.new(284, 66, -956)
    
    for i = 1, 3 do
        pcall(function()
            local character = player.Character or player.CharacterAdded:Wait()
            local hrp = character:WaitForChild("HumanoidRootPart")
            hrp.CFrame = CFrame.new(SHOP_POSITION)
        end)
        task.wait(1)
    end
    
    task.wait(1.5)

    pcall(function()
        local character = player.Character
        local hrp = character and character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end

        local targetPrompt = nil
        local shortestDistance = math.huge

        for _, item in ipairs(workspace.AMain.Market_:GetChildren()) do
            local prompt = item:FindFirstChild("MarketPrompt")
            if prompt and prompt:IsA("ProximityPrompt") then
                pcall(function()
                    local promptPos = item:IsA("BasePart") and item.Position or item.WorldPosition
                    local distance = (hrp.Position - promptPos).Magnitude
                    
                    if distance < shortestDistance then
                        shortestDistance = distance
                        targetPrompt = prompt
                    end
                end)
            end
        end

        if targetPrompt then
            fireproximityprompt(targetPrompt)
        end
    end)
    
    task.wait(2)
    
    pcall(function()
        local args = {
            "Money",
            {
                Bait = {
                    Price = 10,
                    Amount = 10
                }
            }
        }
        player.PlayerGui.Shop.LocalScript.RemoteEvent:FireServer(unpack(args))
    end)
    
    task.wait(2)
    
    pcall(function()
        local args = { "Close" }
        player.PlayerGui.Shop.LocalScript.RemoteEvent:FireServer(unpack(args))
    end)
    
    isBuyingBait = false
end

local function teleportToFishingSpot()
    while isTeleporting or isSelling or isBuyingBait or isBuyingFood do
        task.wait(1)
    end
    
    isTeleporting = true
    
    createFishingPlatform()
    
    task.wait(0.5)
    
    local pos = CFrame.new(-671, 25, -2950)
    
    for i = 1, 3 do
        pcall(function()
            local character = player.Character or player.CharacterAdded:Wait()
            local hrp = character:WaitForChild("HumanoidRootPart")
            hrp.CFrame = pos
        end)
        task.wait(2)
    end
    
    isTeleporting = false
    print("‚úÖ Teleported to fishing spot")
end

local function startFishing()
    toggleFishingRod()
    task.wait(1)
    
    teleportToFishingSpot()
    
    for i = 1, 3 do
        pcall(function()
            ReplicatedStorage.Remote.Main:FireServer("AutoFishing")
        end)
    end
    
    isFishing = true
    currentActivity = "fishing"
    print("üé£ Started fishing")
end

local function resumeFishing()
    toggleFishingRod()
    task.wait(1)
    
    teleportToFishingSpot()
    
    for i = 1, 3 do
        pcall(function()
            ReplicatedStorage.Remote.Main:FireServer("AutoFishing")
        end)
    end
    
    isFishing = true
    currentActivity = "fishing"
    print("üé£ Resumed fishing")
end

local function sellSalmon()
    local sellCount = 0
    
    while true do
        local amount = getFishAmount("Salmon")
        
        if amount <= 0 then
            break
        end
        
        sellCount = sellCount + 1
        
        pcall(function()
            local args = {"Seller", "Salmon", amount}
            player.PlayerGui.ECONOMY.ClientHandler.RemoteEvent:FireServer(unpack(args))
        end)
        
        task.wait(2)
        
        if sellCount >= 20 then
            break
        end
    end
end

local function sellAllFish()
    while isTeleporting or isBuyingBait or isBuyingFood do
        task.wait(1)
    end
    
    isSelling = true
    
    local normalFish = {"Octopus", "Seaweed", "Shrimp"}
    
    for i = 1, 3 do
        pcall(function()
            local character = player.Character or player.CharacterAdded:Wait()
            local hrp = character:WaitForChild("HumanoidRootPart")
            local sellPoint = workspace.AMain[" "].HumanoidRootPart
            hrp.CFrame = sellPoint.CFrame
        end)
        task.wait(2)
    end
    
    task.wait(3)
    
    for i = 1, 3 do
        pcall(function()
            local prompt = workspace.AMain[" "].HumanoidRootPart.Attachment.PromptEconomy
            if prompt and prompt:IsA("ProximityPrompt") then
                fireproximityprompt(prompt)
            end
        end)
        task.wait(1)
    end
    
    task.wait(2)
    
    for _, fishName in ipairs(normalFish) do
        local sellCount = 0
        
        while true do
            local amount = getFishAmount(fishName)
            
            if amount <= 0 then
                break
            end
            
            sellCount = sellCount + 1
            
            pcall(function()
                local args = {"Seller", fishName, amount}
                player.PlayerGui.ECONOMY.ClientHandler.RemoteEvent:FireServer(unpack(args))
            end)
            
            task.wait(2)
            
            if sellCount >= 20 then
                break
            end
        end
        
        task.wait(1)
    end
    
    task.wait(2)
    sellSalmon()
    task.wait(2)
    
    pcall(function()
        local args = {"Close"}
        player.PlayerGui.ECONOMY.ClientHandler.RemoteEvent:FireServer(unpack(args))
    end)
    
    task.wait(1)
    isSelling = false
    print("üí∞ Finished selling fish")
end

--========================================================
--                  GRAPE FUNCTIONS                       
--========================================================

local function getGrapeAmount()
    local amount = 0
    pcall(function()
        local scrollingFrame = player.PlayerGui["Inventory1.5"].Frame.Main.ScrollingFrame.Scrolling
        local grapeItem = scrollingFrame:FindFirstChild("Grape")
        if grapeItem then
            amount = tonumber(grapeItem:GetAttribute("value")) or 0
        end
    end)
    return amount
end

local function getGrapePackAmount()
    local amount = 0
    pcall(function()
        local scrollingFrame = player.PlayerGui["Inventory1.5"].Frame.Main.ScrollingFrame.Scrolling
        local grapePackItem = scrollingFrame:FindFirstChild("GrapePack")
        if grapePackItem then
            amount = tonumber(grapePackItem:GetAttribute("value")) or 0
        end
    end)
    return amount
end

local function getAnyGrape()
    local farmPath = workspace:FindFirstChild("ModelTown") and 
                     workspace.ModelTown:FindFirstChild("Farm") and 
                     workspace.ModelTown.Farm:FindFirstChild("W") and 
                     workspace.ModelTown.Farm.W:FindFirstChild("grape")
    
    if not farmPath then return nil end
    
    for _, v in ipairs(farmPath:GetChildren()) do
        if v:IsA("BasePart") or v:IsA("Model") then
            return v
        end
    end
    return nil
end

local function sellGrapePack()
    while isTeleporting or isProcessing or isBuyingFood do
        task.wait(1)
    end
    
    isSelling = true
    
    for i = 1, 3 do
        pcall(function()
            local character = player.Character or player.CharacterAdded:Wait()
            local hrp = character:WaitForChild("HumanoidRootPart")
            local sellPoint = workspace.AMain[" "].HumanoidRootPart
            hrp.CFrame = sellPoint.CFrame
        end)
        task.wait(2)
    end
    
    task.wait(3)
    
    for i = 1, 3 do
        pcall(function()
            local prompt = workspace.AMain[" "].HumanoidRootPart.Attachment.PromptEconomy
            if prompt and prompt:IsA("ProximityPrompt") then
                fireproximityprompt(prompt)
            end
        end)
        task.wait(1)
    end
    
    task.wait(2)
    
    local sellCount = 0
    
    while true do
        local amount = getGrapePackAmount()
        
        if amount <= 0 then
            break
        end
        
        sellCount = sellCount + 1
        
        pcall(function()
            local args = {"Seller", "GrapePack", amount}
            player.PlayerGui.ECONOMY.ClientHandler.RemoteEvent:FireServer(unpack(args))
        end)
        
        task.wait(2)
        
        if sellCount >= 20 then
            break
        end
    end
    
    task.wait(2)
    
    pcall(function()
        local args = {"Close"}
        player.PlayerGui.ECONOMY.ClientHandler.RemoteEvent:FireServer(unpack(args))
    end)
    
    task.wait(1)
    isSelling = false
    print("üí∞ Finished selling grape pack")
end

local function processGrapes()
    isProcessing = true
    
    pcall(function()
        ReplicatedStorage.Remotes.Farm:FireServer("Stop")
    end)
    
    task.wait(1)
    
    for i = 1, 3 do
        pcall(function()
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                player.Character.HumanoidRootPart.CFrame = CFrame.new(GRAPE_FARM_POSITION)
            end
        end)
        task.wait(2)
    end
    
    task.wait(2)
    
    for i = 1, 3 do
        pcall(function()
            local prompt = workspace.AMain.GrapeProcess.Prompt
            if prompt then
                fireproximityprompt(prompt)
            end
        end)
        task.wait(1)
    end
    
    task.wait(2)
    
    repeat
        task.wait(5)
    until getGrapeAmount() < 1
    
    task.wait(20)
    isProcessing = false
    print("‚úÖ Finished processing grapes")
end

local function startGrapeFarm()
    while isTeleporting or isSelling or isProcessing or isBuyingFood do
        task.wait(1)
    end
    
    -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏≤‡∏£‡πå‡∏°
    local nearbyPlayers = checkNearbyPlayers()
    if #nearbyPlayers > 0 then
        print("‚ö†Ô∏è Players detected near grape farm! Going to fishing instead...")
        print("Players nearby:")
        for _, data in ipairs(nearbyPlayers) do
            print("  - " .. data.player.Name .. " (" .. math.floor(data.distance) .. " studs)")
        end
        return false
    end
    
    -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å
    local currentWeight = getCurrentWeight()
    if currentWeight and currentWeight >= 60 then
        print("‚ö†Ô∏è Weight limit reached! Going to fishing instead...")
        return false
    end
    
    isTeleporting = true
    isFarming = true
    shouldStopGrapeFarm = false
    
    local targetGrape = getAnyGrape()
    
    if not targetGrape then
        task.wait(10)
        isTeleporting = false
        isFarming = false
        return false
    end
    
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if hrp then
        local targetPos = targetGrape:IsA("Model") and targetGrape:GetModelCFrame() or targetGrape.CFrame
        hrp.CFrame = targetPos * CFrame.new(0, 2, 0)
        
        task.wait(1)
        
        pcall(function()
            ReplicatedStorage.Remote.Main:FireServer("FarmItemGame")
        end)
        
        isTeleporting = false
        currentActivity = "grape"
        print("üçá Started grape farming")
        
        -- ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏á‡∏∏‡πà‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤
        while getGrapeAmount() < 30 do
            task.wait(2)
            
            if shouldStopGrapeFarm then
                print("‚ö†Ô∏è Stopping grape farm - player detected!")
                pcall(function()
                    ReplicatedStorage.Remotes.Farm:FireServer("Stop")
                end)
                isFarming = false
                return false
            end
            
            local nearbyPlayers = checkNearbyPlayers()
            if #nearbyPlayers > 0 then
                print("‚ö†Ô∏è Player detected within 500 studs! Switching to fishing...")
                print("Players nearby:")
                for _, data in ipairs(nearbyPlayers) do
                    print("  - " .. data.player.Name .. " (" .. math.floor(data.distance) .. " studs)")
                end
                
                pcall(function()
                    ReplicatedStorage.Remotes.Farm:FireServer("Stop")
                end)
                
                isFarming = false
                shouldStopGrapeFarm = true
                return false
            end
        end
    end
    
    isFarming = false
    print("‚úÖ Grape farming complete (30 grapes)")
    return true
end

--========================================================
--                  FOOD SYSTEM (‡πÄ‡∏ä‡πá‡∏Ñ‡∏ã‡πâ‡∏≥‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏ï‡πá‡∏°)      
--========================================================

local function getHunger()
    local hunger = 100
    pcall(function()
        hunger = player.Status.Hunger.Value
    end)
    return hunger
end

local function getBrain()
    local brain = 100
    pcall(function()
        brain = player.Status.Brain.Value
    end)
    return brain
end

local function buyAndEatFood()
    isBuyingFood = true
    
    local SHOP_POSITION = Vector3.new(284, 66, -956)
    
    -- Teleport to shop
    for i = 1, 3 do
        pcall(function()
            local character = player.Character or player.CharacterAdded:Wait()
            local hrp = character:WaitForChild("HumanoidRootPart")
            hrp.CFrame = CFrame.new(SHOP_POSITION)
        end)
        task.wait(1)
    end
    
    task.wait(1.5)

    -- Fire proximity prompt
    pcall(function()
        local character = player.Character
        local hrp = character and character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end

        local targetPrompt = nil
        local shortestDistance = math.huge

        for _, item in ipairs(workspace.AMain.Market_:GetChildren()) do
            local prompt = item:FindFirstChild("MarketPrompt")
            if prompt and prompt:IsA("ProximityPrompt") then
                pcall(function()
                    local promptPos = item:IsA("BasePart") and item.Position or item.WorldPosition
                    local distance = (hrp.Position - promptPos).Magnitude
                    
                    if distance < shortestDistance then
                        shortestDistance = distance
                        targetPrompt = prompt
                    end
                end)
            end
        end

        if targetPrompt then
            fireproximityprompt(targetPrompt)
        end
    end)
    
    task.wait(2)
    
    -- Buy Snack bar
    pcall(function()
        local args = {
            "Money",
            {
                ["Snack bar"] = {
                    Price = 500,
                    Amount = 1
                }
            }
        }
        player.PlayerGui.Shop.LocalScript.RemoteEvent:FireServer(unpack(args))
    end)
    
    task.wait(1)
    
    -- Buy Cotton candy
    pcall(function()
        local args = {
            "Money",
            {
                ["Cotton candy"] = {
                    Price = 500,
                    Amount = 1
                }
            }
        }
        player.PlayerGui.Shop.LocalScript.RemoteEvent:FireServer(unpack(args))
    end)
    
    task.wait(1)
    
    -- Close shop
    pcall(function()
        local args = {"Close"}
        player.PlayerGui.Shop.LocalScript.RemoteEvent:FireServer(unpack(args))
    end)
    
    task.wait(2)
    
    -- Eat Cotton candy
    pcall(function()
        local args = {"Hunger", 0, "Cotton candy"}
        game.Lighting:WaitForChild("Sky"):WaitForChild("Optimized"):FireServer(unpack(args))
    end)
    
    task.wait(20)
    
    -- Eat Snack bar
    pcall(function()
        local args = {"Hunger", 10, "Snack bar"}
        game.Lighting:WaitForChild("Sky"):WaitForChild("Optimized"):FireServer(unpack(args))
    end)
    
    task.wait(20)
    
    isBuyingFood = false
end

local function ensureFullHungerBrain()
    print("üçî Checking hunger/brain status...")
    
    while true do
        local hunger = getHunger()
        local brain = getBrain()
        
        print("üìä Current status: Hunger=" .. hunger .. ", Brain=" .. brain)
        
        if hunger > 50 and brain > 50 then
            print("‚úÖ Hunger and Brain are sufficient!")
            break
        else
            print("‚ö†Ô∏è Need more food! Hunger=" .. hunger .. ", Brain=" .. brain)
            print("üõí Buying and eating food...")
            
            buyAndEatFood()
            
            task.wait(3)
            
            print("üîÑ Rechecking hunger/brain status...")
        end
    end
    
    print("‚úÖ Food check complete - returning to farm")
end

--========================================================
--                  BACKGROUND THREADS                    
--========================================================

-- Anti-AFK System
task.spawn(function()
    while true do
        task.wait(180) -- 3 ‡∏ô‡∏≤‡∏ó‡∏µ
        
        pcall(function()
            local VirtualInputManager = game:GetService("VirtualInputManager")
            
            -- ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° W ‡πÄ‡∏ö‡∏≤‡πÜ
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.W, false, game)
            task.wait(0.1)
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.W, false, game)
            
            print("‚è∞ Anti-AFK triggered")
        end)
    end
end)

-- Player detection thread (‡∏™‡πà‡∏á Remote Stop ‡πÅ‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
task.spawn(function()
    while true do
        task.wait(1) -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        
        if not AutoFarmEnabled then
            continue
        end
        
        -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        local nearbyPlayers = checkNearbyPlayers()
        
        if #nearbyPlayers > 0 then
            print("üë• Found " .. #nearbyPlayers .. " players nearby!")
            
            for _, data in ipairs(nearbyPlayers) do
                print("  - " .. data.player.Name .. " (" .. math.floor(data.distance) .. " studs)")
            end
            
            -- ‡∏ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏á‡∏∏‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà
            if isFarming and currentActivity == "grape" then
                print("‚ö†Ô∏è STOPPING GRAPE FARM NOW!")
                
                shouldStopGrapeFarm = true
                isFarming = false
                
                -- ‡∏™‡πà‡∏á Remote ‡∏´‡∏¢‡∏∏‡∏î‡∏ü‡∏≤‡∏£‡πå‡∏°
                pcall(function()
                    local ohString1 = "Stop"
                    game:GetService("ReplicatedStorage").Remotes.Farm:FireServer(ohString1)
                    print("‚úÖ Sent Stop signal to server")
                end)
                
                task.wait(5)
                
                -- ‡πÑ‡∏õ‡∏ï‡∏Å‡∏õ‡∏•‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                print("üé£ SWITCHING TO FISHING NOW...")
                startFishing()
            end
        end
    end
end)

-- Check hunger and brain
task.spawn(function()
    while true do
        task.wait(30)
        
        if not AutoFarmEnabled or isBuyingFood or isSelling or isTeleporting then
            continue
        end
        
        local hunger = getHunger()
        local brain = getBrain()
        
        if hunger <= 50 or brain <= 50 then
            print("‚ö†Ô∏è Low hunger/brain detected! Hunger=" .. hunger .. ", Brain=" .. brain)
            
            local wasFishing = isFishing
            local savedActivity = currentActivity

            if isFishing then
                toggleFishingRod()
                isFishing = false
                task.wait(1)
            end
            
            if isFarming then
                pcall(function()
                    ReplicatedStorage.Remotes.Farm:FireServer("Stop")
                end)
                isFarming = false
                task.wait(1)
            end
            
            ensureFullHungerBrain()

            if AutoFarmEnabled then
                if savedActivity == "fishing" then
                    print("üé£ Returning to fishing")
                    resumeFishing()
                elseif savedActivity == "grape" then
                    print("üçá Ready to return to grape farm")
                    shouldStopGrapeFarm = false
                    
                    -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡πÑ‡∏´‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ü‡∏≤‡∏£‡πå‡∏°
                    local nearbyPlayers = checkNearbyPlayers()
                    if #nearbyPlayers == 0 then
                        -- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô ‚Üí ‡∏ß‡∏≤‡∏õ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏á‡∏∏‡πà‡∏ô
                        local targetGrape = getAnyGrape()
                        if targetGrape then
                            pcall(function()
                                local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                                if hrp then
                                    local targetPos = targetGrape:IsA("Model") and targetGrape:GetModelCFrame() or targetGrape.CFrame
                                    hrp.CFrame = targetPos * CFrame.new(0, 2, 0)
                                    task.wait(1)
                                    
                                    -- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÉ‡∏´‡∏°‡πà
                                    ReplicatedStorage.Remote.Main:FireServer("FarmItemGame")
                                    isFarming = true
                                    currentActivity = "grape"
                                    print("‚úÖ Resumed grape farming")
                                end
                            end)
                        end
                    else
                        -- ‡∏°‡∏µ‡∏Ñ‡∏ô ‚Üí ‡πÑ‡∏õ‡∏ï‡∏Å‡∏õ‡∏•‡∏≤‡πÅ‡∏ó‡∏ô
                        print("‚ö†Ô∏è Players still nearby, going to fishing")
                        shouldStopGrapeFarm = true
                        startFishing()
                    end
                end
            end
        end
    end
end)

-- Check bait
task.spawn(function()
    while true do
        task.wait(10)
        
        if not AutoFarmEnabled or currentActivity ~= "fishing" or isBuyingBait or isSelling or isTeleporting or isBuyingFood then
            continue
        end
        
        local baitAmount = getBaitAmount()
        
        if baitAmount < 20 then
            if isFishing then
                toggleFishingRod()
                isFishing = false
                task.wait(1)
            end
            
            buyBait()
            
            if AutoFarmEnabled then
                task.wait(2)
                resumeFishing()
            end
        end
    end
end)


--========================================================
--                  MAIN TAB                              
--========================================================

Tabs.Main:AddParagraph({
    Title = "üéØ Smart Auto Farm",
    Content = "‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞\n‚Ä¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏á‡∏∏‡πà‡∏ô (‡πÄ‡∏ä‡πá‡∏Ñ player)\n‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ player ‚Üí ‡πÑ‡∏õ‡∏ï‡∏Å‡∏õ‡∏•‡∏≤\n‚Ä¢ ‡∏ï‡∏Å‡∏õ‡∏•‡∏≤‡∏à‡∏ô‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å 50 ‚Üí ‡∏Ç‡∏≤‡∏¢\n‚Ä¢ ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏á‡∏∏‡πà‡∏ô (‡∏ß‡∏ô‡∏ã‡πâ‡∏≥)"
})

local AutoFarmToggle = Tabs.Main:AddToggle("AutoFarm", {
    Title = "üöÄ Auto Farm",
    Description = "‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏≠‡∏á‡∏∏‡πà‡∏ô ‚Üí ‡∏ï‡∏Å‡∏õ‡∏•‡∏≤ ‚Üí ‡∏ß‡∏ô‡∏ã‡πâ‡∏≥)",
    Default = _G.CONFIG.AutoFarmOnStart,
    Callback = function(Value)
        AutoFarmEnabled = Value
        
        if Value then
            Fluent:Notify({
                Title = "Auto Farm",
                Content = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥",
                Duration = 3
            })
            
            task.spawn(function()
                while AutoFarmEnabled do
                    -- Phase 1: Try Grape Farm first
                    print("üìç Phase 1: Attempting Grape Farm")
                    
                    local grapeFarmSuccess = startGrapeFarm()
                    
                    if grapeFarmSuccess then
                        -- Process grapes
                        print("üìç Phase 2: Processing grapes")
                        processGrapes()
                        task.wait(2)
                        
                        -- Sell grape pack
                        print("üìç Phase 3: Selling grape pack")
                        sellGrapePack()
                        task.wait(3)
                        
                        print("üîÑ Cycle complete - Trying grape farm again")
                    else
                        -- If grape farm failed, go fishing
                        print("üìç Phase 4: Grape farm failed - Going to fishing")
                        startFishing()
                        
                        while AutoFarmEnabled do
                            task.wait(2)
                            
                            if isSelling or isTeleporting or isBuyingBait or isBuyingFood then
                                continue
                            end
                            
                            local currentWeight = getCurrentWeight()
                            
                            if currentWeight and currentWeight >= 50 then
                                print("‚ö†Ô∏è Weight limit reached: " .. currentWeight .. " KG")
                                
                                if isFishing then
                                    toggleFishingRod()
                                    isFishing = false
                                    task.wait(2)
                                end
                                
                                -- Phase 5: Sell fish
                                print("üìç Phase 5: Selling fish")
                                sellAllFish()
                                task.wait(3)
                                
                                break
                            end
                        end
                        
                        print("üîÑ Fishing complete - Returning to grape farm")
                    end
                    
                    if not AutoFarmEnabled then break end
                    task.wait(2)
                end
            end)
        else
            Fluent:Notify({
                Title = "Auto Farm",
                Content = "‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥",
                Duration = 3
            })
            
            if isFishing then
                toggleFishingRod()
                isFishing = false
            end
            
            if isFarming then
                pcall(function()
                    ReplicatedStorage.Remotes.Farm:FireServer("Stop")
                end)
                isFarming = false
            end
            
            shouldStopGrapeFarm = true
        end
    end
})

--========================================================
--                  INFO TAB                              
--========================================================

Tabs.Info:AddParagraph({
    Title = "üìñ How It Works",
    Content = "1Ô∏è‚É£ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏á‡∏∏‡πà‡∏ô (‡πÄ‡∏ä‡πá‡∏Ñ player)\n2Ô∏è‚É£ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô ‚Üí ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏á‡∏∏‡πà‡∏ô ‚Üí ‡πÅ‡∏õ‡∏£‡∏£‡∏π‡∏õ ‚Üí ‡∏Ç‡∏≤‡∏¢\n3Ô∏è‚É£ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡πá‡∏° ‚Üí ‡∏ï‡∏Å‡∏õ‡∏•‡∏≤\n4Ô∏è‚É£ ‡∏ï‡∏Å‡∏õ‡∏•‡∏≤‡∏à‡∏ô‡πÄ‡∏ï‡πá‡∏° 50 KG ‚Üí ‡∏Ç‡∏≤‡∏¢\n5Ô∏è‚É£ ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏á‡∏∏‡πà‡∏ô (‡∏ß‡∏ô‡∏ã‡πâ‡∏≥)"
})

Tabs.Info:AddParagraph({
    Title = "üçî Smart Food System",
    Content = "‚Ä¢ ‡πÄ‡∏ä‡πá‡∏Ñ Hunger/Brain ‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ\n‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 50 ‚Üí ‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏ô\n‚Ä¢ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ã‡πâ‡∏≥‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞ > 50\n‚Ä¢ ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏ï‡πà‡∏≠‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥"
})

Tabs.Info:AddParagraph({
    Title = "üõ°Ô∏è Player Detection",
    Content = "‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 500 studs\n‚Ä¢ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏á‡∏∏‡πà‡∏ô\n‚Ä¢ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°\n‚Ä¢ ‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏Å‡∏•‡πâ ‚Üí ‡πÑ‡∏õ‡∏ï‡∏Å‡∏õ‡∏•‡∏≤‡πÅ‡∏ó‡∏ô"
})

Tabs.Info:AddParagraph({
    Title = "‚ú® Features",
    Content = "‚Ä¢ üçá Smart Grape Farm (Priority)\n‚Ä¢ üé£ Auto Fishing (Backup)\n‚Ä¢ üí∞ Auto Sell\n‚Ä¢ üçî Auto Buy & Eat Food (Loop)\n‚Ä¢ üéØ Auto Buy Bait\n‚Ä¢ üë• Player Detection (500 studs)"
})

--========================================================
--                  FINAL SETUP                           
--========================================================

if _G.CONFIG.AutoFarmOnStart then
    task.wait(2)
    print("üöÄ [CONFIG] Auto starting farm system")
    AutoFarmToggle:SetValue(true)
end

Fluent:Notify({
    Title = "‚úÖ Smart Auto Farm Loaded!",
    Content = "‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô",
    Duration = 5
})

print("‚úÖ Smart Auto Farm System Loaded!")
print("üìã Priority:")
print("  1Ô∏è‚É£ Grape Farm (check players)")
print("  2Ô∏è‚É£ Fishing (if grape unavailable)")
print("  3Ô∏è‚É£ Auto Food (loop until >50)")
print("  4Ô∏è‚É£ Player Detection (500 studs)")
